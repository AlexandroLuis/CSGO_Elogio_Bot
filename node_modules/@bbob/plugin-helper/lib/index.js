'use strict';

exports.__esModule = true;
exports.isEOL = exports.isStringNode = exports.isTagNode = exports.getNodeLength = exports.appendToNode = exports.attrValue = exports.attrsToString = undefined;

var _char = require('./char');

var isTagNode = function isTagNode(el) {
  return typeof el === 'object' && !!el.tag;
};
var isStringNode = function isStringNode(el) {
  return typeof el === 'string';
};
var isEOL = function isEOL(el) {
  return el === _char.N;
};

var getNodeLength = function getNodeLength(node) {
  if (isTagNode(node)) {
    return node.content.reduce(function (count, contentNode) {
      return count + getNodeLength(contentNode);
    }, 0);
  } else if (isStringNode(node)) {
    return node.length;
  }

  return 0;
};

/**
 * Appends value to Tag Node
 * @param {TagNode} node
 * @param value
 */
var appendToNode = function appendToNode(node, value) {
  node.content.push(value);
};

/**
 * Replaces " to &qquot;
 * @param {String} value
 */
var escapeQuote = function escapeQuote(value) {
  return value.replace(/"/g, '&quot;');
};

/**
 * Acept name and value and return valid html5 attribute string
 * @param {String} name
 * @param {String} value
 * @return {string}
 */
var attrValue = function attrValue(name, value) {
  var type = typeof value;

  var types = {
    boolean: function boolean() {
      return value ? '' + name : '';
    },
    number: function number() {
      return name + '="' + value + '"';
    },
    string: function string() {
      return name + '="' + escapeQuote(value) + '"';
    },
    object: function object() {
      return name + '="' + escapeQuote(JSON.stringify(value)) + '"';
    }
  };

  return types[type] ? types[type]() : '';
};

/**
 * Transforms attrs to html params string
 * @param values
 */
var attrsToString = function attrsToString(values) {
  // To avoid some malformed attributes
  if (typeof values === 'undefined') {
    return '';
  }

  return Object.keys(values).reduce(function (arr, key) {
    return [].concat(arr, [attrValue(key, values[key])]);
  }, ['']).join(' ');
};

exports.attrsToString = attrsToString;
exports.attrValue = attrValue;
exports.appendToNode = appendToNode;
exports.getNodeLength = getNodeLength;
exports.isTagNode = isTagNode;
exports.isStringNode = isStringNode;
exports.isEOL = isEOL;